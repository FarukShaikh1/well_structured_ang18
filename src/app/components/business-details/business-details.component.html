<div
  class="modal fade modal-md"
  id="businessDetailsPopup"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add Business</h4>
        <button
          #btnCloseBusinessDetailsPopup
          class="btn-close"
          (click)="closePopup()"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body">
        <form
          [formGroup]="businessDetailsForm"
          (ngSubmit)="submitBusinessDetails()"
        >
          <div>
            <div style="display: none">
              <p>businessId</p>
              <input formControlName="businessId" />
            </div>
            <div class="row">
              <div class="col-4">
                <label> Choose a date</label>
                <input
                  id="businessDate"
                  class="form-control form-control-lg text-dark bg-transparent"
                  type="date"
                  placeholder="DD/MM/YYYY"
                  appearance="outline"
                  formControlName="businessDate"
                  [ngClass]="{
                    'error-border':
                      businessDetailsForm.get('businessDate')?.touched &&
                      businessDetailsForm.get('businessDate')?.invalid
                  }"
                />
                @if(businessDetailsForm.get('businessDate')?.touched &&
                businessDetailsForm.get('businessDate')?.invalid){
                <div class="text-danger">
                  @if(businessDetailsForm.get('businessDate')?.errors?.['required']){
                  Date is required. } 
                  @else if(businessDetailsForm.get('businessDate')?.errors?.['pattern']){
                  Invalid Date. }
                </div>
                }
              </div>

              <div class="col-5">
                <label>Customer Name</label>
                <input
                  type="text"
                  placeholder="Enter Customer Name"
                  aria-label="Customer Name"
                  class="form-control form-control-lg text-dark bg-transparent"
                  formControlName="sourceOrReason"
                  (input)="onSourceReasonChange($event)"
                  (focus)="focusInSource = true"
                  (focusout)="focusOutSource()"
                  [ngClass]="{
                    'error-border':
                      businessDetailsForm.get('sourceOrReason')?.touched &&
                      businessDetailsForm.get('sourceOrReason')?.invalid
                  }"
                />
                @if(businessDetailsForm.get('sourceOrReason')?.touched &&
                businessDetailsForm.get('sourceOrReason')?.invalid){
                <div class="text-danger">
                  @if(businessDetailsForm.get('sourceOrReason')?.errors?.['required']){
                  Source/Reason is required. } 
                  @else if(businessDetailsForm.get('sourceOrReason')?.errors?.['pattern']){
                  Invalid source/Reason. }
                </div>
                } @if(filteredSourceOrReasonList?.length > 0 && focusInSource){
                <ul class="list-group suggestion-list">
                  @for(option of filteredSourceOrReasonList;track $index){
                  <li
                    class="list-group-item list-group-item-action"
                    (click)="selectSourceOrReason(option)"
                  >
                    {{ option }}
                  </li>
                  }
                </ul>
                }
              </div>
              <div class="col-3">
                <label>Payment</label>
                <select
                  placeholder="Paid"
                  aria-label="Paid"
                  class="form-control form-control-lg text-dark bg-transparent"
                >
                  <option value="Pending">Pending</option>
                  <option value="Paid Fully">Paid Fully</option>
                  <option value="Paid Partially">Paid Partially</option>
                  <option value="Advance">Advance</option>
                </select>
              </div>
              <!-- <div class="col-4">
                                <label>Sale/Purchase</label> &nbsp;
                                <span class="d-flex">
                                    <input type="radio" value="Purchase"> Purchase
                                </span>
                                <span class="d-flex">
                                    <input type="radio" value="Sale"> Sale
                                </span>
                            </div> -->
            </div>
            <div class="row mt-4">
              <div class="col-3">
                <label>Product</label>
                <input
                  formControlName="sbiAccount"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
              <div class="col-3">
                <label>Quantity</label>
                <input
                  formControlName="sbiAccount"
                  class="form-control form-control-lg text-dark bg-transparent"
                  (keydown)="globalService.validateAmount($event)"
                  (keyup)="validateAmountFields()"
                />
              </div>
              <div class="col-3">
                <label>Unit</label>
                <input
                  formControlName="cash"
                  (keyup)="validateAmountFields()"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
              <div class="col-3">
                <label> Delevery date</label>
                <input
                  id="businessDate"
                  class="form-control form-control-lg text-dark bg-transparent"
                  type="date"
                  placeholder="DD/MM/YYYY"
                  appearance="outline"
                  formControlName="businessDate"
                  [ngClass]="{
                    'error-border':
                      businessDetailsForm.get('businessDate')?.touched &&
                      businessDetailsForm.get('businessDate')?.invalid
                  }"
                />
                @if(businessDetailsForm.get('businessDate')?.touched &&
                businessDetailsForm.get('businessDate')?.invalid){
                <div class="text-danger">
                  @if(businessDetailsForm.get('businessDate')?.errors?.['required']){
                  Date is required. } 
                  @else if(businessDetailsForm.get('businessDate')?.errors?.['pattern']){
                  Invalid Date. }
                </div>
                }
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-3">
                <label>Deal Amount</label>
                <input
                  formControlName="cash"
                  (keydown)="globalService.validateAmount($event)"
                  (keyup)="validateAmountFields()"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
              <div class="col-3">
                <label>Paid Amount</label>
                <input
                  formControlName="cash"
                  (keydown)="globalService.validateAmount($event)"
                  (keyup)="validateAmountFields()"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
              <div class="col-3">
                <label>Paid By</label>
                <input
                  formControlName="cash"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
              <div class="col-3">
                <label>Pending Amount</label>
                <input
                  formControlName="cash"
                  (keydown)="globalService.validateAmount($event)"
                  (keyup)="validateAmountFields()"
                  class="form-control form-control-lg text-dark bg-transparent"
                />
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-12">
                <label>More Details (if any)</label>
                <textarea
                  formControlName="description"
                  (input)="onDescriptionChange($event)"
                  (focus)="focusInDescription = true"
                  (focusout)="focusOutDescription()"
                  placeholder="Details about business"
                  class="form-control form-control-lg text-dark bg-transparent"
                ></textarea>

                @if(filteredDescriptionList?.length > 0 && focusInDescription){
                <ul
                  class="list-group position-absolute w-50 mt-0 overflow-auto"
                  style="max-height: 300px; overflow-y: auto"
                >
                  @for(option of filteredDescriptionList;track $index){
                  <li
                    class="list-group-item list-group-item-action"
                    (click)="selectDescription(option)"
                  >
                    {{ option }}
                  </li>
                  }
                </ul>
                }
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-12 col-sm-12">
                <div class="action d-flex justify-content-end">
                  <button
                    class="btn btn-secondary rounded-button"
                    type="button"
                    (click)="closePopup()"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                  <button class="btn btn-danger rounded-button" type="reset">
                    Reset
                  </button>
                  <button
                    class="btn btn-primary rounded-button"
                    type="submit"
                    [disabled]="businessDetailsForm.invalid || !isValidAmount"
                  >
                    Save
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<app-toaster></app-toaster>
