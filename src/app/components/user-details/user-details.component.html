<div class="modal fade" id="userDetailsPopup" data-bs-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">{{ modalTitle }}</h4>
        <button
          #btnCloseUserPopup
          class="btn-close"
          (click)="closePopup()"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
          <input type="hidden" formControlName="id" />

          <div class="mb-3">
            <label for="userEmail" class="form-label">Email ID <span class="required"></span></label>
            <input
              type="email"
              class="form-control"
              id="userEmail"
              formControlName="email"
              [readonly]="isEditMode"
              placeholder="Enter Email ID"
              (input)="populateDetails($event);trimAllFields()"
              [ngClass]="{
                'error-border':
                  userForm.get('email')?.touched &&
                  userForm.get('email')?.invalid,
                'readonly-select': isEditMode
              }"
            />

            @if(((userForm.get('email')?.dirty ||
            userForm.get('email')?.touched) &&
            userForm.get('email')?.invalid)||emailAlreadyExists) {
            <div class="text-danger">
              @if(emailAlreadyExists && !userForm.get('email')?.errors){
              <small>A user with this email already exists.<br /></small>
              } @if(userForm.get('email')?.errors?.['required']) {
              <small>Email ID is required.<br /></small>
              } @if(userForm.get('email')?.errors?.['pattern']) {
              <small>{{ Messages.EMAIL_VALIDATION_MSG }}<br /></small>
              }
            </div>
            }
          </div>

          <div class="mb-3">
            <label for="fullName" class="form-label">Name <span class="required"></span></label>
            <input
              type="text"
              class="form-control"
              id="userName"
              formControlName="username"
              placeholder="Enter Name"
              (change)="trimAllFields()"
              [ngClass]="{
                'error-border':
                  userForm.get('username')?.touched &&
                  userForm.get('username')?.invalid
              }"
            />
            @if((userForm.get('username')?.dirty ||
            userForm.get('username')?.touched) &&
            userForm.get('username')?.invalid) {
            <div class="text-danger">
              @if(userForm.get('username')?.errors?.['required']) {
              <small>Name is required.<br /></small>
              } @else if(userForm.get('username')?.errors?.['pattern']) {
              <small>Invalid username<br /></small>
              }
            </div>
            }
          </div>

          <div class="mb-3">
            <label for="userRole" class="form-label">Role <span class="required"></span></label>
            @if(existingUserRole){
            <input
              type="text"
              class="form-control"
              id="role"
              formControlName="role"
              [readonly]="existingUserRole != '' || emailAlreadyExists"
              [ngClass]="{
                'readonly-select': existingUserRole
              }"
            />
            } @else{

            <select
              id="role"
              formControlName="role"
              class="form-select form-control"
              (change)="trimAllFields()"
              [ngClass]="{
                'error-border':
                  userForm.get('role')?.touched &&
                  userForm.get('role')?.invalid,
                'readonly-select': existingUserRole || emailAlreadyExists
              }"
            >
              <option value="" selected hidden>Select Role</option>
              @for(role of roleList;track $index){
              <!--@if(role.name!==ApplicationRoles.Platform_Admin) {-->
              <option
                value="{{ role.id }}"
                [selected]="existingUserRole === role.name"
              >
                {{ role.name }}
              </option>
              } <!--}-->
            </select>

            @if((userForm.get('role')?.dirty || userForm.get('role')?.touched)
            && userForm.get('role')?.invalid) {
            <div class="text-danger">
              @if(userForm.get('role')?.errors?.['required']) {
              <small>Role is required.<br /></small>
              }
            </div>
            } }
          </div>
          @if(isClientRepresentativeSelected) {
          <div class="mb-3">
            <label for="clientID" class="form-label">Client <span class="required"></span></label>
            <select
              id="clientID"
              formControlName="clientID"
              class="form-select form-control"
              (change)="trimAllFields()"
              [ngClass]="{
                'error-border':
                  userForm.get('clientID')?.touched &&
                  userForm.get('clientID')?.invalid,
                'readonly-select': isEditMode
              }"
            >
              <option value="" [disabled]="isEditMode" selected hidden>
                Select Client
              </option>
            </select>
            @if((userForm.get('clientID')?.dirty ||
            userForm.get('clientID')?.touched) &&
            userForm.get('clientID')?.invalid) {
            <div class="text-danger">
              @if(userForm.get('clientID')?.errors?.['required']) {
              <small>Client is required.<br /></small>
              }
            </div>
            }
          </div>
          }

          <div class="d-flex justify-content-end">
            <button
              type="button"
              (click)="closePopup()"
              class="btn rounded-button-small me-2"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>

            <button
              type="submit"
              class="btn btn-danger rounded-button rounded-button-small"
              [disabled]="userForm.invalid || emailAlreadyExists"
            >
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<app-toaster></app-toaster>
